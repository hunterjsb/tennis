
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hunterjsb's ELO History</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body { padding: 2rem; }
        .chart-container { height: 400px; }
        .footer { margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #dee2e6; font-size: 0.9rem; color: #6c757d; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">hunterjsb's ELO History</h1>

        <div class="mb-3">
            <select id="matchTypeSelector" class="form-select" style="width: auto;">
                <option value="singles">Singles</option>
                <option value="doubles">Doubles</option>
            </select>
        </div>

        <div class="chart-container">
            <canvas id="eloChart"></canvas>
        </div>

        <div class="footer">
            <p><a href="index.html">Back to Leaderboards</a> | <a href="history.html">Match History</a> | <a href="https://github.com/your-org/your-repo">GitHub Repository</a></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const ctx = document.getElementById('eloChart').getContext('2d');
            let chart;
            let playerData;

            function createChart(data, matchType) {
                if (chart) {
                    chart.destroy();
                }

                // Create custom candlestick-style chart using bar + line combination
                const candlestickData = data.candlestick;
                const scatterData = data.scatter;

                // Create datasets for candlestick simulation
                const candlestickBars = candlestickData.map(d => ({
                    x: d.x,
                    y: [d.l, d.h], // Full range: low to high
                    backgroundColor: d.c >= d.o ? 'rgba(34, 197, 94, 0.6)' : 'rgba(239, 68, 68, 0.6)',
                    borderColor: d.c >= d.o ? 'rgb(34, 197, 94)' : 'rgb(239, 68, 68)',
                    borderWidth: 2,
                    ohlc: d // Store full OHLC data
                }));

                chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        datasets: [
                            {
                                label: 'Daily ELO Range',
                                data: candlestickBars,
                                barThickness: 20,
                                backgroundColor: function(context) {
                                    const ohlc = context.raw.ohlc;
                                    return ohlc.c >= ohlc.o ? 'rgba(34, 197, 94, 0.8)' : 'rgba(239, 68, 68, 0.8)';
                                },
                                borderColor: function(context) {
                                    const ohlc = context.raw.ohlc;
                                    return ohlc.c >= ohlc.o ? 'rgb(34, 197, 94)' : 'rgb(239, 68, 68)';
                                },
                                borderWidth: 2,
                                order: 2
                            },
                            {
                                label: 'Individual Sets',
                                type: 'scatter',
                                data: scatterData,
                                backgroundColor: function(context) {
                                    const result = context.raw.details.result;
                                    return result === 'W' ? 'rgba(34, 197, 94, 0.9)' : 'rgba(239, 68, 68, 0.9)';
                                },
                                borderColor: function(context) {
                                    const result = context.raw.details.result;
                                    return result === 'W' ? 'rgb(34, 197, 94)' : 'rgb(239, 68, 68)';
                                },
                                pointRadius: 5,
                                pointHoverRadius: 7,
                                borderWidth: 2,
                                order: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Date'
                                }
                            },
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: 'ELO'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    generateLabels: function(chart) {
                                        return [
                                            {
                                                text: 'Daily Range: Green = Positive Day, Red = Negative Day',
                                                fillStyle: 'rgba(34, 197, 94, 0.8)',
                                                strokeStyle: 'rgb(34, 197, 94)',
                                                lineWidth: 2
                                            },
                                            {
                                                text: 'Sets: Green = Win, Red = Loss',
                                                fillStyle: 'rgba(34, 197, 94, 0.9)',
                                                strokeStyle: 'rgb(34, 197, 94)',
                                                lineWidth: 2,
                                                pointStyle: 'circle'
                                            }
                                        ];
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        if (context.datasetIndex === 1) { // Individual sets
                                            const details = context.raw.details;
                                            let tooltip = `ELO: ${details.elo} (${details.elo_change > 0 ? '+' : ''}${details.elo_change})`;
                                            tooltip += `\nResult: ${details.result} vs ${details.opponent}`;
                                            if (details.partner) {
                                                tooltip += ` (with ${details.partner})`;
                                            }
                                            tooltip += `\nSets: ${details.sets}`;
                                            return tooltip;
                                        } else if (context.datasetIndex === 0) { // Candlestick bars
                                            const ohlc = context.raw.ohlc;
                                            return [
                                                `Daily ELO Summary:`,
                                                `Open: ${Math.round(ohlc.o)}`,
                                                `High: ${Math.round(ohlc.h)}`,
                                                `Low: ${Math.round(ohlc.l)}`,
                                                `Close: ${Math.round(ohlc.c)}`
                                            ];
                                        }
                                        return '';
                                    }
                                }
                            }
                        },
                        onClick: (e) => {
                            const points = chart.getElementsAtEventForMode(e, 'nearest', { intersect: true }, true);
                            if (points.length) {
                                const firstPoint = points[0];
                                if (firstPoint.datasetIndex === 1) { // Individual sets
                                    const dataPoint = chart.data.datasets[1].data[firstPoint.index];
                                    if (dataPoint.details.issue_number) {
                                        window.open(`https://github.com/your-org/your-repo/issues/${dataPoint.details.issue_number}`, '_blank');
                                    }
                                }
                            }
                        }
                    }
                });
            }

            fetch('history/hunterjsb.json')
                .then(response => response.json())
                .then(data => {
                    playerData = data;
                    const matchTypeSelector = document.getElementById('matchTypeSelector');

                    createChart(playerData.singles, 'singles');

                    matchTypeSelector.addEventListener('change', (event) => {
                        createChart(playerData[event.target.value], event.target.value);
                    });
                });
        });
    </script>
</body>
</html>
